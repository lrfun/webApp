<!doctype html>  
<html>  
<head lang="zh-CN">  
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<title>web App</title> 
<!-- Make sure that we can test against real IE8 --> 
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--<link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.2.min.css">-->
<link rel="stylesheet" href="http://apps.bdimg.com/libs/jquerymobile/1.4.2/jquery.mobile.min.css">
</head> 
<body> 
<!--页面1-->
<div data-role="page" id="index" >
	<div data-role="header">
      <a href="#" data-icon="arrow-l" data-iconpos="left" data-rel="back" data-transition="slide" data-direction="reverse">Back</a>  
		  <h1>列车时刻表查询</h1>
	</div>
	<div role="main" class="ui-content">

		<!--首页搜索-->
		<form >
			<div class="ui-field-contain">
				<label>始发站</label>
				<input type="text" id="searchStart">
			</div>
			<div class="ui-field-contain">
				<label>终点站</label>
				<input type="text" id="searchEnd">
			</div>
			<div class="ui-field-contain">
				<label>车次</label>
				<input type="text" id="searchNum">
			</div>
		</form>
		<input type="submit" value="搜索" id="searchBtn">

		<!--首页搜索出的车次-->
		<ul data-role="listview" data-inset="true" id="list">
           <li>
           	<a href="#">
           		<h2>G1次</h2>
           		<p>成都-上海</p>
           		<p>用时:3小时50分</p>
           		<p class="ui-li-aside">09:45:00 开</p>
           	</a>
           </li>
           <li>
           	<a href="#">
           		<h2>G1001次</h2>
           		<p>北京-成都</p>
           		<p>用时:4小时30分</p>
           		<p class="ui-li-aside">09:00:00 开</p>
           	</a>
           </li>
           <li>
           	<a href="#">
           		<h2>G1002次</h2>
           		<p>北京南-上海虹桥</p>
           		<p>用时:10小时50分</p>
           		<p class="ui-li-aside">08:00:00 开</p>
           	</a>
           </li>
           <li>
           	<a href="#">
           		<h2>G1003次</h2>
           		<p>北京南-青海</p>
           		<p>用时:2小时37分</p>
           		<p class="ui-li-aside">23:00:00 开</p>
           	</a>
           </li>
		</ul>
	</div>
	<div data-role="footer" data-position="fixed">
		<div data-role="navbar">
			<ul>
          <li><a href="#index" data-role="tab" data-icon="grid" class="ui-btn-active">查询</a></li>
          <li><a href="#star" data-role="tab" data-icon="star">收藏</a></li>
          <li><a href="#setting" data-role="tab" data-icon="gear">设置</a></li>
			</ul>
		</div>
	</div>
</div>
<!--页面2-->
<div data-role="page" id="detail">

    <div data-role="header" >
        <a href="#" data-icon="arrow-l" data-iconpos="left" data-rel="back" data-transition="slide" data-direction="reverse">Back</a>  
        <h1>列车时刻表详情</h1>
    </div>

    <div role="main" class="ui-content">
        <h2></h2>
        <table data-role="table" id="movie-table" data-mode="reflow" class="ui-responsive">
            <thead>
            <tr>
                <th data-priority="1">站名</th>
                <th data-priority="persist">到站时间</th>
                <th data-priority="persist">出发时间</th>
            </tr>
            </thead>
            <tbody>
            	<tr>
      					<td>成都</td>
      					<td>G1次</td>
      					<td>09:00:00</td>
      				</tr>
            </tbody>
        </table>
    </div>

    <div data-role="footer" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#index" data-role="tab" data-icon="grid" class="ui-btn-active">查询</a></li>
                <li><a href="#star" data-role="tab" data-icon="star">收藏</a></li>
                <li><a href="#setting" data-role="tab" data-icon="gear">设置</a></li>
            </ul>
        </div>
    </div>
</div>

<div data-role="page" id="star">
  <div data-role="header">  
      <a href="#" data-icon="arrow-l" data-iconpos="left" data-rel="back" data-transition="slide" data-direction="reverse">Back</a>  
      <h1>Star Page</h1>  
  </div>  
  <div data-role="content">  
      <!--首页搜索出的车次-->
    <ul data-role="listview" data-inset="true" id="list">
       <li>
        <a href="#">
          <h2>G1002次</h2>
          <p>北京南-上海虹桥</p>
          <p>用时:10小时50分</p>
          <p class="ui-li-aside">08:00:00 开</p>
        </a>
       </li>
       <li>
        <a href="#">
          <h2>G1003次</h2>
          <p>北京南-青海</p>
          <p>用时:2小时37分</p>
          <p class="ui-li-aside">23:00:00 开</p>
        </a>
       </li>
    </ul>
  </div>  
  <div data-role="footer" data-position="fixed">  
      <div data-role="navbar">  
          <ul>  
             <li><a href="#index" data-role="tab" data-icon="grid" class="ui-btn-active">查询</a></li>
             <li><a href="#star" data-role="tab" data-icon="star">收藏</a></li>
             <li><a href="#setting" data-role="tab" data-icon="gear">设置</a></li> 
          </ul>  
      </div>  
  </div>  
</div>
<div data-role="page" id="setting">
  <div data-role="header">  
      <a href="#" data-icon="arrow-l" data-iconpos="left" data-rel="back" data-transition="slide" data-direction="reverse">Back</a>  
      <h1>Setting Page</h1>  
  </div>  
  <div data-role="content">  
     <form method="post" action="#">
      <fieldset data-role="collapsible">
        <legend>设置主题</legend>
          <label for="name">全名：</label>
          <input type="text" name="text" id="name">
          <p>喜爱的颜色：</p>
        <div data-role="controlgroup">
          <label for="red">红色</label>
          <input type="checkbox" name="favcolor" id="red" value="red">
          <label for="green">绿色</label>
          <input type="checkbox" name="favcolor" id="green" value="green">
          <label for="blue">蓝色</label>
          <input type="checkbox" name="favcolor" id="blue" value="blue">
        </div>  
      <input type="submit" data-inline="true" value="提交">
      </fieldset>
    </form>
  </div>  
  <div data-role="footer" data-position="fixed">  
      <div data-role="navbar">  
          <ul>  
             <li><a href="#index" data-role="tab" data-icon="grid" class="ui-btn-active">查询</a></li>
             <li><a href="#star" data-role="tab" data-icon="star">收藏</a></li>
             <li><a href="#setting" data-role="tab" data-icon="gear">设置</a></li> 
          </ul>  
      </div>  
  </div>  
</div>

<script src="http://apps.bdimg.com/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/jquerymobile/1.4.2/jquery.mobile.min.js"></script>
<script type="text/javascript">
	  
    var urlPre = "http://www.corsproxy.com/"; //跨域中转
    
    var url1 = "www.webxml.com.cn/WebServices/TrainTimeWebService.asmx/getStationAndTimeByStationName?UserID=";// 通过始发站&终点站获得车次列表
    
    // var url2 = "www.webxml.com.cn/WebServices/TrainTimeWebService.asmx/getStationAndTimeDataSetByLikeTrainCode?UserID=";// 通过车次获得车次列表
    var url2 = "http://www.chepiao100.com/api/checi";

    var url3 = "www.webxml.com.cn/WebServices/TrainTimeWebService.asmx/getDetailInfoByTrainCode?UserID="; // 通过车次查询列车经过车站明细
    
    var isbind = 0;

    // 获取车次列表
    var getTrainList=function(){

    	if($("#searchNum").val() || ($("#searchStart").val() && $("#searchEnd").val())){
        
        var searchButton=$("#searchBtn");
        
        searchButton.button("option","disabled",true);

        $.mobile.loading("show");

        var _data={userid:'lrfung@126.com',seckey:'e08fd3a0fc7fa48bcc1da4456bba5f24'};
        var _url=url1;
        if(!$("#searchNum").val()){
          _data.StartStation=$("#searchStart").val();
          _data.ArriveStation=$("#searchEnd").val();
        } else {
          _data.trainCode=$("#searchNum").val();
          _url=url2;
        }
        $.ajax({
          type: 'POST',
          url: _url ,
          data: _data ,
          dataType: 'JSONP',
          success:function(data){
            var list=$("#list");
            var timeTables=$("data").find("TimeTable");

            var _arr=[];

            timeTables.each(function(index,obj){
              var i=index;
              if(i>10) return false;

              var that=$(this);
              if(that.find("FirstStation").text()=="没有发现数据"){
                alert("没有发现数据");
                return false;
              }

              var _html='<li><a href="#" data-no="'+that.find("TrainCode").text()+'">'+
              '<h2>'+that.find("TrainCode").text()+'</h2>'+
              '<p>'+that.find("FirstStation").text()+'-'+that.find("LastStation").text()+'</p>'+
              '<p>用时:'+that.find("UseDate").text()+'</p>'+
              '<p class="ui-li-aside">'+that.find("StartTime").text()+'开</p>'+'</a></li>';
               
              _arr.push(_html);


            })
            if(_arr.length>0){
              list.html(_arr.join(""));
              list.listview("refrech");
            }
            $.mobile.loading("hide");
            searchButton.button("option","disabled",false);

          }
        });
    	} else {
    		alert("请输入需查询内容!");
    	}
    };

    // 查看车次详细信息
    var getInfoByTrainCode=function(trainCode){
        //3、获取车次信息，跳转到详情页面
        //ajax...
        $.mobile.changePage( "#detail" );
    };

    var bindEvent=function(){
      $("#searchBtn").on("click",function(){
        $("#list").show();
      });

      $("#list").on("click","a",function(){
        //1、获取到当前点击的item
        //2、获取该车次号码
        getInfoByTrainCode("trainCode");
      });

    };

    $(document).on("pageinit","#index",function(){
      $("#list").hide();
    	bindEvent();
    });
</script>
</body>  
</html>
